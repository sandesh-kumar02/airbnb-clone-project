<% layout('layouts/boilerplate') %> <% title = 'Listing Details' %> <% bodyClass
= 'show-listing-page' %>

<!-- ================= Leaflet CSS ================= -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>

<div class="container py-5">
  <div class="mx-auto" style="max-width: 720px">
    <div class="card shadow-lg rounded-4">
      <img
        src="<%= showListing.image.url %>"
        class="card-img-top"
        alt="listing image"
      />

      <div class="card-body">
        <h3 class="card-title mb-3"><%= showListing.title %></h3>
        <i>Owned By <%= showListing.owner.username %></i>

        <p class="card-text text-muted"><%= showListing.description %></p>

        <p class="card-text fw-bold">
          &#8377; <%= showListing.price.toLocaleString('en-IN') %> / night
        </p>

        <p class="card-text">
          <i class="fa-solid fa-location-dot"></i>
          <%= showListing.location %>, <%= showListing.country %>
        </p>
      </div>

      <% if (currUser && showListing.owner._id.equals(currUser._id)) { %>
      <div class="card-footer d-flex justify-content-between">
        <a href="/listings/<%= showListing._id %>/edit" class="btn btn-warning"
          >‚úèÔ∏è Edit</a
        >

        <form
          action="/listings/<%= showListing._id %>?_method=DELETE"
          method="POST"
        >
          <button class="btn btn-danger">üóë Delete</button>
        </form>
      </div>
      <% } %>
    </div>
  </div>
</div>

<!-- ================= MAP ================= -->
<div class="container mt-5">
  <div id="map" style="height: 350px; border-radius: 12px"></div>
</div>

<!-- ================= Leaflet JS ================= -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- üî• GeoJSON coordinates FIRST -->
<script>
  // MongoDB format: [lng, lat]
  const coordinates = <%- JSON.stringify(showListing.geometry.coordinates) %>;
</script>

<!-- üî• Map logic AFTER -->
<script src="/js/map.js"></script>
